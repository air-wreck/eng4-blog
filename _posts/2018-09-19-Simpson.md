---
layout: post
title: Simpson's Rule on the TI nspire
date: Sep 19, 2018
summary: this post is nspiring
link: 2018-09-19-Simpson
needsmath: true
---

On the multivar quiz tomorrow, we need to know [Simpson's rule](https://en.wikipedia.org/wiki/Simpson's_rule) for numerical integration using a second-order polynomial approximation. The formula is:

$$
\int_a ^b f(x) \,\mathrm{d}x= \frac{b-a}{3n}(f(x_0) + 4f(x_1) + 2f(x_2) + ... + f(x_n))
$$

We can write a function to do this on the TI-nspire for an arbitrary expression in $$x$$.

Here's what our function will look like in the end:

```
Define simpson(f, a, b, m) = ...
```

For: the expression $$f$$, lower bounds $$a$$, upper bounds $$b$$, and number of intervals $$m$$. First, we need a way to evaluate $$f$$ at all those intervals. We'll need to use the `seqn` function to generate the list of x-values we want and evaluate the expression $$f$$ at each of those points:

$$
f\vert x = \textrm{seqn}\left(a + \frac{(b-a) \cdot (n-1)}{m}, m+1\right)
$$

This evaluates to the list:

```
{f(x0), f(x1), f(x2), ..., f(xn)}
```

Now, we need to generate the coefficient list `{1,4,2,4,2,...4,1}` and take the inner product of these two lists. We can express the coefficient list in terms of a piecewise function on the nspire:

$$
\textrm{seqn}\left(
\begin{cases}
1, & n = 1 \;\textrm{or}\; n = m+1 \\
4, & \textrm{mod}(n,2) = 0 \\
2, & \textrm{Else}
\end{cases}, m+1
\right)
$$

We can take the inner product by simply multiplying the lists and using the `sum` function on the result. So, our final (somewhat unwieldy) function is something like:

$$
\textrm{Define }\mathbf{simpson}(f, a, b, m) =
\frac{b - a}{3 \cdot m} \cdot
\textrm{sum}\left(
  \left(
    f\vert x = \textrm{seqn}\left(a + \frac{(b-a) \cdot (n-1)}{m}, m+1\right)
  \right) \cdot
    \textrm{seqn}\left(
    \begin{cases}
    1, & n = 1 \;\textrm{or}\; n = m+1 \\
    4, & \textrm{mod}(n,2) = 0 \\
    2, & \textrm{Else}
    \end{cases}, m+1
    \right)
\right)
$$

---
An important note: the `simpson` function takes an **expression** in $$x$$. It does not take a function. For example, to use it, we would write:

$$
\mathbf{simpson}\left( 100x\sqrt{125-x^3}, 0, 5, 12 \right)
$$

If we wanted to use it on a univariate function `f1` defined as:

$$
\mathbf{f1}(x) = 100x\sqrt{125-x^3}
$$

We would first evaluate the function at $$x$$ and *then* use the `simpson` function:

$$
\mathbf{simpson}\left( \mathbf{f1}(x), 0, 5, 12 \right)
$$
